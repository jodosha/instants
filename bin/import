#!/usr/bin/env ruby
require 'bundler/setup'
require_relative '../config/environment'
Lotus::Application.preload_applications!

require 'instagram'

Instagram.configure do |config|
  config.client_id     = ENV['INSTAGRAM_CLIENT_ID']
  config.client_secret = ENV['INSTAGRAM_CLIENT_SECRET']
end

user = Instagram.user_search(ARGV[0]).first
raise "User not found: #{ ARGV[0] }" if user.nil?

user = UserRepository.create_from_remote(user)
Instagram.user_recent_media(user.instagram_id, count: 100).each do |media|
  PictureRepository.create_from_media(user, media)
end
